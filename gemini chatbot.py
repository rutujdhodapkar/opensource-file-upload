import os
import requests
import streamlit as st

# Use environment variable for security
API_KEY = os.getenv('AIzaSyBNjhY65I_0C-j4E6GjIZt9JtocJ67fXJ4')

def call_gemini_api(user_message):
    url = "https://gemini.googleapis.com/v1/some-endpoint"  # Modify this based on Gemini API docs
    headers = {
        "Authorization": f"Bearer {API_KEY}",
        "Content-Type": "application/json"
    }

    data = {
        "prompt": user_message,
        "maxTokens": 100  # Adjust this based on API specs
    }

    response = requests.post(url, json=data, headers=headers)
    
    if response.status_code == 200:
        return response.json().get("response", "No valid response from Gemini API")
    else:
        return f"Error: {response.status_code}, {response.text}"

# Streamlit UI
st.title("Gemini Chatbot")

user_message = st.text_input("You: ", "")

if st.button("Send"):
    if user_message:
        gemini_response = call_gemini_api(user_message)
        st.write(f"Gemini: {gemini_response}")
    else:
        st.write("Please enter a message to send.")
