<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload Server</title>
</head>
<body>
    <h1>File Upload Server</h1>
    <button id="serverButton">Activate Server</button>
    <button id="clientButton">Access Client</button>

    <div id="serverControls" style="display:none;">
        <h2>Server Controls</h2>
        <input type="password" id="password" placeholder="Enter passcode" />
        <button id="startServer">Start Server</button>
        <button id="stopServer">Stop Server</button>
        <h3>Upload File</h3>
        <input type="file" id="fileUpload" />
        <button id="uploadFile">Upload</button>
    </div>

    <div id="clientControls" style="display:none;">
        <h2>Client Access</h2>
        <input type="password" id="clientPassword" placeholder="Enter passcode to connect" />
        <button id="connectClient">Connect</button>
        <button id="listFiles">List Files</button>
        <div id="fileList"></div>
    </div>

    <script>
        let isConnected = false;

        document.getElementById('serverButton').onclick = function() {
            document.getElementById('serverControls').style.display = 'block';
            document.getElementById('clientControls').style.display = 'none';
        };

        document.getElementById('clientButton').onclick = function() {
            document.getElementById('clientControls').style.display = 'block';
            document.getElementById('serverControls').style.display = 'none';
        };

        document.getElementById('startServer').onclick = async function() {
            const password = document.getElementById('password').value;
            const response = await fetch('/activate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password })
            });
            const data = await response.json();
            alert(data.message);
        };

        document.getElementById('stopServer').onclick = async function() {
            const response = await fetch('/deactivate', {
                method: 'POST'
            });
            const data = await response.json();
            alert(data.message);
        };

        document.getElementById('uploadFile').onclick = async function() {
            if (!isConnected) {
                alert("Please connect to the server first.");
                return;
            }

            const fileInput = document.getElementById('fileUpload');
            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            alert(data.message);
        };

        document.getElementById('connectClient').onclick = function() {
            const clientPassword = document.getElementById('clientPassword').value;
            if (clientPassword === '15010') {  // Check against the server password
                isConnected = true;
                alert("Connected to the server.");
            } else {
                alert("Invalid passcode. Please try again.");
            }
        };

        document.getElementById('listFiles').onclick = async function() {
            if (!isConnected) {
                alert("Please connect to the server first.");
                return;
            }

            const response = await fetch('/files');
            const files = await response.json();
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = files.map(file => `<a href="/files/${file}" target="_blank">${file}</a>`).join('<br>');
        };
    </script>
</body>
</html>
