<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Files to GitHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input[type="file"] {
            margin: 10px 0;
        }
        button {
            margin: 5px 0;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Upload Files to GitHub</h1>
    <input type="file" id="fileInput" accept=".txt, .csv, .pdf, .ppt, .pptx, .html, .css, .js, .json, .xml, .py, .java, .c, .cpp, .rb, .go, image/*, video/*" />
    <button id="uploadButton">Upload</button>
    <button id="refreshButton">Refresh Files</button>

    <h2>Files in Repository:</h2>
    <ul id="fileList"></ul>

    <script>
        const uploadButton = document.getElementById('uploadButton');
        const refreshButton = document.getElementById('refreshButton');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const repoOwner = 'rutujdhodapkar'; // Your GitHub username
        const repoName = 'opensource-file-upload'; // Your repository name
        const token = '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'; // Your personal access token

        let lastFiles = []; // To track the last state of files

        // Fetch and display the list of files in the repository
        async function fetchFiles() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });

                if (response.ok) {
                    const files = await response.json();
                    const fileNames = files.map(file => file.name); // Get an array of file names

                    // Check for changes in the file list
                    if (JSON.stringify(fileNames) !== JSON.stringify(lastFiles)) {
                        lastFiles = fileNames; // Update the last known file list
                        renderFileList(files); // Update the UI
                    }
                } else {
                    console.error('Error fetching files:', response.statusText);
                }
            } catch (error) {
                console.error('Error fetching files:', error);
            }
        }

        // Render the file list to the UI
        function renderFileList(files) {
            fileList.innerHTML = ''; // Clear the list
            files.forEach(file => {
                const li = document.createElement('li');
                li.textContent = file.name;
                fileList.appendChild(li);
            });
        }

        uploadButton.addEventListener('click', async () => {
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select a file to upload.');
                return;
            }

            // Check file size (for example, limit to 10MB)
            const maxSizeInMB = 10;
            if (file.size > maxSizeInMB * 1024 * 1024) {
                alert(`File size exceeds the limit of ${maxSizeInMB}MB.`);
                return;
            }

            const filePath = file.name;
            const fileExtension = filePath.split('.').pop().toLowerCase();

            // Use FileReader to read the file
            const reader = new FileReader();
            reader.onload = async () => {
                let fileContent = reader.result.split(',')[1]; // Get base64 content

                // Check if the file is a coding language format
                if (isCodeFile(fileExtension)) {
                    // Convert to plain text (base64 to UTF-8)
                    fileContent = btoa(fileContent); // Convert to base64 to UTF-8
                }

                try {
                    const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Upload ${filePath}`,
                            content: fileContent
                        })
                    });

                    if (response.ok) {
                        alert('File uploaded successfully!');
                        fetchFiles(); // Refresh the file list after upload
                    } else {
                        const errorData = await response.json();
                        handleError(response.status, errorData);
                    }
                } catch (error) {
                    console.error('Error uploading file:', error);
                    alert('An error occurred while uploading the file.');
                }
            };

            reader.onerror = () => {
                console.error('Error reading file:', reader.error);
                alert('An error occurred while reading the file.');
            };

            reader.readAsDataURL(file); // Read the file as a data URL
        });

        // Function to check if the file is a coding language format
        function isCodeFile(extension) {
            const codeFileExtensions = ['py', 'js', 'java', 'c', 'cpp', 'rb', 'go', 'html', 'css'];
            return codeFileExtensions.includes(extension);
        }

        // Event listener for refresh button
        refreshButton.addEventListener('click', () => {
            fetchFiles(); // Fetch the latest files when refresh button is clicked
        });

        function handleError(status, errorData) {
            switch (status) {
                case 401:
                    alert('Unauthorized: Check your token permissions.');
                    break;
                case 404:
                    alert('Repository not found: Check the repository name and owner.');
                    break;
                case 422:
                    alert('Unprocessable Entity: Check if the file is too large or invalid.');
                    break;
                default:
                    alert('Error uploading file: ' + errorData.message);
            }
            console.error('Error details:', errorData);
        }

        // Fetch the list of files when the page loads
        fetchFiles();

        // Set an interval to refresh the file list every 2 seconds
        setInterval(fetchFiles, 2000);
    </script>
</body>
</html>
